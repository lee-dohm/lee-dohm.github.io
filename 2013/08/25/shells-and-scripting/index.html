<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Raleway' rel='stylesheet' type='text/css'>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="application/atom+xml" rel="alternate" href="https://www.lee-dohm.com/feed.xml" title="lee-dohm.com" />
    <link rel="icon" type="image/png" href="/favicon-icon.png"/>

    <!-- Bootstrap -->
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen" />

    <!-- Site -->
    <link href="/stylesheets/styles.css" rel="stylesheet" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- MathJax -->
    <script type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <!-- Battle for the Net widget https://github.com/fightforthefuture/battleforthenet-widget -->
    <!-- <script src="https://widget.battleforthenet.com/widget.js" async></script> -->

    <!-- analytics.html -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17382346-2', 'lee-dohm.com');
  ga('send', 'pageview');
</script>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Shells and Scripting | lee-dohm.com</title>
<meta name="generator" content="Jekyll v4.1.0" />
<meta property="og:title" content="Shells and Scripting" />
<meta name="author" content="Lee Dohm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve spent a significant chunk of my weekend playing around with a new command-line shell, fish, the Friendly Interactive SHell. I’d seen people using it on a couple of screencasts and thought about checking it out for quite a while. I finally got around to it …" />
<meta property="og:description" content="I’ve spent a significant chunk of my weekend playing around with a new command-line shell, fish, the Friendly Interactive SHell. I’d seen people using it on a couple of screencasts and thought about checking it out for quite a while. I finally got around to it …" />
<link rel="canonical" href="https://www.lee-dohm.com/2013/08/25/shells-and-scripting/" />
<meta property="og:url" content="https://www.lee-dohm.com/2013/08/25/shells-and-scripting/" />
<meta property="og:site_name" content="lee-dohm.com" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-08-25T20:00:59-07:00" />
<script type="application/ld+json">
{"datePublished":"2013-08-25T20:00:59-07:00","url":"https://www.lee-dohm.com/2013/08/25/shells-and-scripting/","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.lee-dohm.com/2013/08/25/shells-and-scripting/"},"author":{"@type":"Person","name":"Lee Dohm"},"description":"I’ve spent a significant chunk of my weekend playing around with a new command-line shell, fish, the Friendly Interactive SHell. I’d seen people using it on a couple of screencasts and thought about checking it out for quite a while. I finally got around to it …","headline":"Shells and Scripting","dateModified":"2013-08-25T20:00:59-07:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-custom" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Lee Dohm</a>
        <p class="navbar-text">Games and Technology Should Include EVERYone</p>
      </div>

      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/archives">Archive</a></li>
          <li><a href="/feed.xml">Feed</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="/about">About Lee</a></li>
              <li><a href="/this-blog">About This Blog</a></li>
              <li><a href="/appearances">Appearances</a></li>
              <li><a href="/colophon">Colophon</a></li>
              <li><a href="/disclaimer">Disclaimers</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div class="row">
        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            

<div class="content">
  <h1><a class="title" href="/2013/08/25/shells-and-scripting/">Shells and Scripting</a></h1>
  <!-- dateline.html -->
<h4 class="dateline">
  August 25, 2013
  •
  <a href="/2013/08/25/shells-and-scripting/"><span class="octicon octicon-link"></span></a>
</h4>


  <p>I’ve spent a significant chunk of my weekend playing around with a new command-line shell, <a href="http://www.fishshell.com">fish</a>, the <strong>F</strong>riendly <strong>I</strong>nteractive <strong>SH</strong>ell. I’d seen people using it on a couple of screencasts and thought about checking it out for quite a while. I finally got around to it …</p>

<p>It was a little frustrating to work with at first because it is designed to be simpler to use and therefore friendlier than other shells, so I had to convert some of the ways I was doing things in my older shell, <a href="http://www.zsh.org/">zsh</a>, to the new way of doing things. But after I got done replicating all of my environment customizations in fish, it turns out that my fish configuration is <em>tons</em> simpler than the one in zsh. I was pretty impressed, so I’ve switched over my main computer and will probably switch over my work computers this week. But as I worked with it, something bothered me.</p>

<p>It is interesting that with all the progress in computers over the last few decades, we still use command-line environments that have remained largely unchanged since about the 1980s. In the 80s many people were still writing significant amounts of code in BASIC, COBOL, Fortran and other primitive languages. We have rightly done away with those archaic systems and replaced them with much more modern ones. But what languages that should have gone the way of Latin and Sanskrit do I still see people writing whole programs in? Shell scripts.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup></p>

<p>It’s true that the scripting language in fish is <em>much</em> simpler and more consistent than zsh or <a href="http://www.gnu.org/software/bash/">bash</a>, but I have never seen a shell scripting language that can hold a candle to even the worst modern scripting language,<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote">2</a></sup> let alone one of the better ones. There is one and only one capability that shell scripting languages have that other languages can’t easily replicate: setting environment variables. But environment variables are the <strong>globalest</strong> of global variables … not only can they be read or written anywhere in your program like normal global variables but environment variables can be read, and if you’re writing shell scripts written, by <em>other</em> programs too! There are other ways to communicate state between programs now people! <img class="emoji" title=":rage:" alt=":rage:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f621.png" height="20" width="20"></p>

<p>Other than raw capabilities programming-wise, there is one other argument for these languages of yesteryear. That is their ubiquity. Every Unix machine comes with bash already installed. Every single Windows machine and every DOS machine before that can run batch files. But it is also their ubiquity that ties them down, that ossifies them, to the point where they go for decades without changing, without keeping up with the times. And in this day and age of always-on Internet connections and easy-to-use <a href="http://brew.sh">package</a> <a href="http://en.wikipedia.org/wiki/Advanced_Packaging_Tool">managers</a>, installing something better is only a few keystrokes away.</p>

<p>Let’s take a look at an example. I wrote some code to reorder the <code class="language-plaintext highlighter-rouge">PATH</code> environment variable in fish. It does the following:</p>

<ol>
  <li>Locates <code class="language-plaintext highlighter-rouge">/usr/bin</code> and <code class="language-plaintext highlighter-rouge">/usr/local/bin</code> in the <code class="language-plaintext highlighter-rouge">PATH</code>
</li>
  <li>If <code class="language-plaintext highlighter-rouge">/usr/local/bin</code> is <em>after</em> <code class="language-plaintext highlighter-rouge">/usr/bin</code> it:
    <ol>
      <li>Removes <code class="language-plaintext highlighter-rouge">/usr/local/bin</code>
</li>
      <li>Inserts <code class="language-plaintext highlighter-rouge">/usr/local/bin</code> just before <code class="language-plaintext highlighter-rouge">/usr/bin</code>
</li>
    </ol>
  </li>
</ol>

<p>This is the implementation in fish:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">set</span> <span class="nt">--local</span> bin_index <span class="o">(</span>contains <span class="nt">--index</span> /usr/bin <span class="nv">$PATH</span><span class="o">)</span>
<span class="nb">set</span> <span class="nt">--local</span> local_bin_index <span class="o">(</span>contains <span class="nt">--index</span> /usr/local/bin <span class="nv">$PATH</span><span class="o">)</span>

<span class="k">if </span><span class="nb">test</span> <span class="nv">$local_bin_index</span> <span class="nt">-gt</span> <span class="nv">$bin_index</span>
    <span class="nb">set</span> <span class="nt">--erase</span> <span class="nv">$PATH</span><span class="o">[</span><span class="nv">$local_bin_index</span><span class="o">]</span>

    <span class="nb">set</span> <span class="nt">--local</span> local_path <span class="s1">''</span>
    <span class="k">if </span><span class="nb">test</span> <span class="o">(</span>math <span class="nv">$bin_index</span> - 1<span class="o">)</span> <span class="nt">-gt</span> 0
        <span class="nb">set </span>local_path <span class="nv">$PATH</span><span class="o">[</span>1..<span class="o">(</span>math <span class="nv">$bin_index</span> - 1<span class="o">)]</span>
    end

    <span class="nb">set </span>local_path <span class="nv">$local_path</span> /usr/local/bin
    <span class="nb">set </span>local_path <span class="nv">$local_path</span> <span class="nv">$PATH</span><span class="o">[</span><span class="nv">$bin_index</span>..-1]

    <span class="nb">set</span> <span class="nt">--global</span> <span class="nt">--export</span> PATH <span class="nv">$local_path</span>
end
</code></pre></div></div>

<p>And here is the equivalent Ruby code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">path</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'PATH'</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sr">/:/</span><span class="p">)</span>

<span class="n">bin_index</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">find_index</span><span class="p">(</span><span class="s1">'/usr/bin'</span><span class="p">)</span>
<span class="n">local_bin_index</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">find_index</span><span class="p">(</span><span class="s1">'/usr/local/bin'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">local_bin_index</span> <span class="o">&gt;</span> <span class="n">bin_index</span>
  <span class="n">path</span><span class="p">.</span><span class="nf">delete_at</span><span class="p">(</span><span class="n">local_bin_index</span><span class="p">)</span>
  <span class="n">path</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">bin_index</span><span class="p">,</span> <span class="s1">'/usr/local/bin'</span><span class="p">)</span>

  <span class="no">ENV</span><span class="p">[</span><span class="s1">'PATH'</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Ruby has a reputation for being concise, so let’s not look at line counts and such.<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote">3</a></sup> But the <em>clarity</em> of the code is clearly worse in fish … maybe not a lot worse, but worse all the same. I don’t count this as a fault of fish shell. It isn’t meant to be a general-purpose programming language and the code here is <em>much</em> more concise, readable, understandable and maintainable than the same thing would be in bash! The fish language is way ahead of other shell scripting languages,<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote">4</a></sup> but that’s not a high bar. I mean, it’s on their homepage, “Finally, a command line shell for the 90s”. And they’re joking, but only just.</p>

<p>What this all boils down to is that I’m all for shell scripts that allow you to customize your working environment. Or shell scripts that make a simple task even simpler.<sup id="fnref:5" role="doc-noteref"><a href="#fn:5" class="footnote">5</a></sup> But if a shell script grows to over 20 lines of code, or you’re confronted with error handling, or you start namespacing your environment variables so they don’t clash <img class="emoji" title=":sob:" alt=":sob:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f62d.png" height="20" width="20">, or you start constructing a series of libraries to manage all the shell code you have <img class="emoji" title=":confounded:" alt=":confounded:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f616.png" height="20" width="20">, it is time to rewrite it in a real programming language. The command line is a great place to execute <em>ad hoc</em> commands to deal with one-off tasks<sup id="fnref:6" role="doc-noteref"><a href="#fn:6" class="footnote">6</a></sup> but shell scripts are not a replacement for real code.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>This includes <a href="http://en.wikipedia.org/wiki/Batch_files">batch files</a> on Windows as well. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>I nominate Perl. <img class="emoji" title=":laughing:" alt=":laughing:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png" height="20" width="20"> <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>Ok, I can’t resist. I’ll just put it down here in a footnote. The fish implementation is 60% larger by line count and 88% larger by character count! <img class="emoji" title=":scream:" alt=":scream:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f631.png" height="20" width="20"> <a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:4" role="doc-endnote">
      <p>With the possible exception of <a href="http://technet.microsoft.com/en-us/scriptcenter/powershell.aspx">Windows PowerShell</a>. <a href="#fnref:4" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:5" role="doc-endnote">
      <p>If you want to see what sorts of things I automate at the command line, check out my <a href="https://github.com/lee-dohm/environment">environment project</a> on GitHub. <a href="#fnref:5" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:6" role="doc-endnote">
      <p>Though both Python and Ruby come with <a href="http://en.wikipedia.org/wiki/REPL">REPL</a> environments that serve a very similar purpose. <a href="#fnref:6" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
  </ol>
</div>

</div>
</div>
</div>
</div>
</div></body></html>

          </div>
        </div>

        <div class="col-md-8 col-md-offset-2">
          <hr/>
          <div class="text-center">
            <p>
              <a href="mailto:lee@lee-dohm.com"><span class="octicon octicon-mail"></span></a>&nbsp;&nbsp;
              <a href="https://github.com/lee-dohm"><span class="octicon octicon-mark-github"></span></a>&nbsp;&nbsp;
              <a href="//stackoverflow.com/users/1954/lee"><i class="fa fa-stack-exchange"></i></a>&nbsp;&nbsp;
              <a href="https://twitter.com/leedohm"><i class="fa fa-twitter"></i></a>
            </p>
            <p>
              Copyright &copy; 2010-2022 by Lee Dohm
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/javascripts/lightbox.min.js"></script>
  </body>
</html>
